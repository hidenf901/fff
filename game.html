<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lk-90 - Игра</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .nav {
            background: #f5f7fa;
            padding: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav a {
            padding: 10px 20px;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            text-decoration: none;
            border-radius: 8px;
        }
        .content { padding: 30px; text-align: center; }
        canvas {
            border: 2px solid #1a2a6c;
            border-radius: 8px;
            background: #f5f7fa;
        }
        .info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        .start { background: #27ae60; }
        .pause { background: #e74c3c; }
        .reset { background: #f39c12; }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: #95a5a6;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Мини-игра</h1>
        </div>
        
        <div class="nav">
            <a href="dashboard.html">Главная</a>
            <a href="showcase.html">Витрина</a>
            <a href="notes.html">Заметки</a>
            <a href="game.html">Игра</a>
            <a href="chat.html">Чат</a>
            <a href="tasks.html">Задания</a>
        </div>
        
        <div class="content">
            <a href="dashboard.html" class="back-btn">← На главную</a>
            
            <canvas id="game" width="400" height="400"></canvas>
            
            <div class="info">
                <div>Счет: <span id="score">0</span></div>
                <div>Уровень: <span id="level">1</span></div>
            </div>
            
            <div>
                <button class="start" onclick="startGame()">Старт</button>
                <button class="pause" onclick="pauseGame()">Пауза</button>
                <button class="reset" onclick="resetGame()">Сброс</button>
            </div>
        </div>
    </div>

    <script>
        let canvas, ctx;
        let gameRunning = false;
        let gamePaused = false;
        let score = 0;
        let level = 1;
        let player = { x: 200, y: 350, size: 20 };
        let obstacles = [];

        function checkAuth() {
            const currentUser = localStorage.getItem('currentUser');
            const users = JSON.parse(localStorage.getItem('users'));
            if (!currentUser || !users[currentUser]) window.location.href = 'index.html';
        }

        function init() {
            canvas = document.getElementById('game');
            ctx = canvas.getContext('2d');
            draw();
        }

        function draw() {
            ctx.clearRect(0, 0, 400, 400);
            
            // Земля
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 370, 400, 30);
            
            // Игрок
            ctx.fillStyle = '#3498db';
            ctx.fillRect(player.x, player.y, player.size, player.size);
            
            // Препятствия
            ctx.fillStyle = '#e74c3c';
            obstacles.forEach(obs => {
                ctx.fillRect(obs.x, obs.y, 20, 20);
            });
        }

        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            gamePaused = false;
            gameLoop();
        }

        function pauseGame() {
            gamePaused = !gamePaused;
            if (!gamePaused) gameLoop();
        }

        function resetGame() {
            gameRunning = false;
            gamePaused = false;
            score = 0;
            level = 1;
            obstacles = [];
            player.x = 200;
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            draw();
        }

        function gameLoop() {
            if (!gameRunning || gamePaused) return;
            
            // Движение препятствий
            obstacles.forEach(obs => obs.x -= 3 + level);
            obstacles = obstacles.filter(obs => obs.x > -20);
            
            // Создание новых препятствий
            if (Math.random() < 0.02) {
                obstacles.push({ x: 400, y: 350, size: 20 });
            }
            
            // Проверка столкновений
            obstacles.forEach(obs => {
                if (player.x < obs.x + 20 && player.x + 20 > obs.x &&
                    player.y < obs.y + 20 && player.y + 20 > obs.y) {
                    score += 10;
                    if (score % 50 === 0) level++;
                    document.getElementById('score').textContent = score;
                    document.getElementById('level').textContent = level;
                }
            });
            
            draw();
            setTimeout(gameLoop, 50);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' && player.x > 0) player.x -= 10;
            if (e.key === 'ArrowRight' && player.x < 380) player.x += 10;
            draw();
        });

        checkAuth();
        init();
    </script>
</body>
</html>
